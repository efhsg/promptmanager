window.QuillEditors=window.QuillEditors||{},window.QuillToolbar=function(){const t='<svg viewBox="0 0 18 18" width="18" height="18" class="ql-spin"><circle cx="9" cy="9" r="6" fill="none" stroke="currentColor" stroke-width="2" stroke-dasharray="20 10"/></svg>',e=()=>{const t=document.querySelector('meta[name="csrf-token"]');return t?t.content||t.getAttribute("content"):""},o=(t,e)=>{let o=document.getElementById("quill-toolbar-toast-container");o||(o=document.createElement("div"),o.id="quill-toolbar-toast-container",o.className="toast-container position-fixed bottom-0 end-0 p-3",o.innerHTML='<div class="toast align-items-center border-0" role="alert"><div class="d-flex"><div class="toast-body"></div><button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button></div></div>',document.body.appendChild(o));const n=o.querySelector(".toast");n.querySelector(".toast-body").textContent=t,n.className="toast align-items-center border-0 text-bg-"+(e||"secondary"),window.bootstrap&&window.bootstrap.Toast&&new bootstrap.Toast(n,{delay:2e3}).show()},n=()=>{if(!document.getElementById("ql-spin-style")){const t=document.createElement("style");t.id="ql-spin-style",t.textContent=".ql-spin { animation: ql-spin 1s linear infinite; } @keyframes ql-spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }",document.head.appendChild(t)}};return{setupSmartPaste:(a,r,i)=>{const s=a.getModule("toolbar");if(!s||!s.container)return;const d=s.container.querySelector(".ql-smartPaste");if(!d)return;const l=i&&i.importTextUrl||"/scratch-pad/import-text";n();const c=document.createElement("button");c.type="button",c.className="ql-smartPaste",c.title="Smart Paste (auto-detects markdown)",c.innerHTML='<svg viewBox="0 0 18 18" width="18" height="18"><rect x="3" y="2" width="12" height="14" rx="1" fill="none" stroke="currentColor" stroke-width="1"/><rect x="6" y="0" width="6" height="3" rx="0.5" fill="none" stroke="currentColor" stroke-width="1"/><text x="9" y="13" text-anchor="middle" font-size="9" font-weight="bold" font-family="sans-serif" fill="currentColor">P</text></svg>',d.replaceWith(c),c.addEventListener("click",async()=>{const n=c.innerHTML;try{const n=await navigator.clipboard.readText();if(!n.trim())return void o("Clipboard is empty","warning");c.innerHTML=t,c.disabled=!0;const i=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-Token":e(),"X-Requested-With":"XMLHttpRequest"},body:JSON.stringify({text:n})}),s=await i.json();if(s.success&&s.importData&&s.importData.content){const t="string"==typeof s.importData.content?JSON.parse(s.importData.content):s.importData.content,e=Quill.import("delta");if(a.getLength()<=1)a.setContents(t);else{const o=a.getSelection(!0);a.updateContents((new e).retain(o.index).concat(t))}r&&(r.value=JSON.stringify(a.getContents())),o("md"===s.format?"Pasted as markdown":"Pasted as text","success")}else o(s.message||"Failed to paste content","danger")}catch(t){console.error("SmartPaste error:",t),o("Unable to read clipboard","danger")}finally{c.innerHTML=n,c.disabled=!1}})},setupLoadMd:(a,r,i)=>{const s=a.getModule("toolbar");if(!s||!s.container)return;const d=s.container.querySelector(".ql-loadMd");if(!d)return;const l=i&&i.importMarkdownUrl||"/scratch-pad/import-markdown";n();const c=document.createElement("input");c.type="file",c.accept=".md,.markdown,.txt",c.style.display="none",document.body.appendChild(c);const u=document.createElement("button");u.type="button",u.className="ql-loadMd",u.title="Load markdown file",u.innerHTML='<svg viewBox="0 0 18 18" width="18" height="18"><path d="M4 2h7l4 4v10a1 1 0 01-1 1H4a1 1 0 01-1-1V3a1 1 0 011-1z" fill="none" stroke="currentColor" stroke-width="1"/><path d="M9 7v6M7 11l2 2 2-2" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/></svg>',d.replaceWith(u),u.addEventListener("click",()=>c.click()),c.addEventListener("change",async function(){const n=this.files[0];if(!n)return;const i=u.innerHTML;u.innerHTML=t,u.disabled=!0;try{const t=new FormData;t.append("mdFile",n);const i=await fetch(l,{method:"POST",body:t,headers:{"X-CSRF-Token":e(),"X-Requested-With":"XMLHttpRequest"}}),s=await i.json();if(s.success&&s.importData&&s.importData.content){const t="string"==typeof s.importData.content?JSON.parse(s.importData.content):s.importData.content,e=Quill.import("delta");if(a.getLength()<=1)a.setContents(t);else{const o=a.getSelection(!0);a.updateContents((new e).retain(o.index).concat(t))}r&&(r.value=JSON.stringify(a.getContents())),o("Loaded "+n.name,"success")}else o(s.errors?.mdFile?.[0]||s.message||"Failed to load file","danger")}catch(t){console.error("Load MD error:",t),o("Failed to load file","danger")}finally{u.innerHTML=i,u.disabled=!1,c.value=""}})},showToast:o}}(),document.addEventListener("DOMContentLoaded",()=>{const t=t=>{if(t.dataset.inited)return;t.dataset.inited=1;const e=document.getElementById(t.dataset.target),o=JSON.parse(t.dataset.config),n=new Quill(t,o);e&&e.id&&(window.QuillEditors[e.id]=n);const a={importTextUrl:t.dataset.importTextUrl,importMarkdownUrl:t.dataset.importMarkdownUrl};if(window.QuillToolbar.setupSmartPaste(n,e,a),window.QuillToolbar.setupLoadMd(n,e,a),e.value)try{n.setContents(JSON.parse(e.value))}catch(t){console.warn("Delta parse",t)}n.on("text-change",()=>e.value=JSON.stringify(n.getContents()))};document.querySelectorAll('[data-editor="quill"]').forEach(t),new MutationObserver(e=>e.forEach(e=>e.addedNodes.forEach(e=>e.querySelectorAll?.('[data-editor="quill"]').forEach(t)))).observe(document.body,{childList:!0,subtree:!0})});